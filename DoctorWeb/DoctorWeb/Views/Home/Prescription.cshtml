@model DoctorWeb.Models.CustomModels.PrescriptionHome

@{
    //ViewBag.Title = "Prescription";
    Layout = "~/Views/Shared/_PrescriptionLayout.cshtml";
}
@*
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/themes/blitzer/jquery-ui.css"
          rel="Stylesheet" type="text/css" />*@

@if (ViewBag.Message != null)
{
    <script type="text/javascript">
        //jQuery.noConflict();
        document.addEventListener('DOMContentLoaded', function () {
            alert('@ViewBag.Message');
        });
    </script>

}

@using (Html.BeginForm("Prescription", "Home", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div id="msform_right">
        <div class="form-horizontal">
            <div class="form_fieldset_div">
                <div id="testDiv1">
                    <fieldset style="height: 100%">
                        <h2 class="fs-title" style="text-align:center;">
                            <a href="#" class="imgdrawing" id="ImageDrawing" onclick="imagelightbox();"><img src="~/Content/Images/imagedrawing.png" style="width:40px; height:40px; padding-right:5px;" /></a>
                            <div class="image-upload">
                                <label for="file-input1">
                                    <img src="~/Content/Images/imageupload.png" />
                                </label>
                                <input id="file-input1" name="preImage1" type="file" />
                            </div>
                            <div class="image-upload">
                                <label for="file-input2">
                                    <img src="~/Content/Images/imageupload.png" />
                                </label>
                                <input id="file-input2" name="preImage2" type="file" />
                            </div>

                            <a href="#" class="webcam_img" onclick="patientimage();"><img src="/Content/Images/webcam.png" /></a>

                            @{
                                if (ViewBag.PrescriptionID != 0)
                                {
                                    <a href="@Url.Action("PrintPreview", "Home", new { id = ViewBag.PatientID })" target="blank" class="profile_pic_img"><img src="/Content/Images/print_icon.png" style="pointer-events:auto;"/></a>
                                    <a href="@Url.Action("FollowUp", "Home", new { patientID = ViewBag.PatientID, id = ViewBag.PrescriptionID })" target="blank" class="profile_pic_img"><img src="/Content/Images/previous_prescription.png" style="pointer-events:auto;"/></a>
                                    <a href="@Url.Action("PrintInvoicePreview", "Home", new { id = ViewBag.PrescriptionID })" target="blank" class="profile_pic_img"><img src="/Content/Images/invoice.png" style="pointer-events:auto;"/></a><span>Prescription Form</span>
                                }
                                else
                                {
                                    <a href="#" class="profile_pic_img"><img src="/Content/Images/print_icon.png" style="opacity:0.5; pointer-events:none;"/></a>
                                    <a href="#" class="profile_pic_img"><img src="/Content/Images/previous_prescription.png" style="opacity:0.5; pointer-events:none;"/></a>
                                    <a href="#" class="profile_pic_img"><img src="/Content/Images/invoice.png" style="opacity:0.5; pointer-events:none;"/></a><span>Prescription Form</span>
                                }

                            }

                        </h2>
                        @*<h2 class="fs-title" style="text-align:center;"><a href="#" class="webcam_img" onclick="patientimage();"><img src="/Content/Images/webcam.png" /></a><a href="#" class="profile_pic_img"><img src="/Content/Images/profilepic.png" /></a><a href="#" onclick="printform();" class="profile_pic_img"><img src="/Content/Images/print_icon.png" /></a>Prescription Form</h2>*@
                        <div style="width:100%; clear:both;">
                            <label title="Rx" class="rx_label rx_label_right">Rx</label>
                            <div style="width: auto; padding-top:10px; padding-right: 8px; float:left;" class="btn_box">
                                @foreach (var item in Model.Categories)
                                {
                                    <input type="button" id="btnp1" readonly style="border: 1px solid rgb(69,117,212);color:rgb(69,117,212)" class="btn_p a" value="@Html.DisplayFor(modelItem => item.Name)" content="0;U">
                                }
                                <input style="height:25px !important; width:25px !important; float:right; margin-left:5px !important; padding-top:3px !important;" value="+" class="plusbutton" type="button" required>

                            </div>
                            <label title="Rx" style="float:left; border:0px solid; padding-top:13px;">
                                @Html.EditorFor(model => model.Days, new { htmlAttributes = new { name = "patient_days_presc", id = "patient_days_presc", placeholder = "Days", style = "width:70px;", @min = "1", @step = "1", Value = "" } })
                                @Html.ValidationMessageFor(model => model.Days, "", new { @class = "text-danger" })
                                @Html.EditorFor(model => model.Diagnosis, new { htmlAttributes = new { name = "patient_diagnosis_presc", id = "patient_diagnosis_presc", @placeholder = "Diagnosis", style = "width:140px;" } })
                                @Html.ValidationMessageFor(model => model.Diagnosis, "", new { @class = "text-danger" })
                                @Html.EditorFor(model => model.Procedure, new { htmlAttributes = new { name = "patient_diagnosis_presc", id = "patient_procedure_presc", placeholder = "Procedure", style = "width:140px;" } })
                                @Html.ValidationMessageFor(model => model.Procedure, "", new { @class = "text-danger" })
                            </label>
                        </div>

                        @*DRAW IMAGES*@

                        <div id="DrawImage"></div>
                        <div id="ImageLightbox"></div>
                        <div id="PrintForm"></div>

                        @*Medicine*@

                        <div id="div1">
                            <div class="input_fields_wrap" id="input_fields_wrap_js">
                                <div id="divname_1" class="divnamepresc">
                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.OINT, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.DropDownList("OINTTypeID", null, htmlAttributes: new { @class = "pre tabname", @id = "tabname_1", @style = "width: 75px!important; max-width: 70px!important; padding: 0!important;" })
                                    @*@Html.EnumDropDownListFor(model => model.Medicine.OINT, htmlAttributes: new { @class = "pre tabname", @id = "tabname_1", @style = "width: 85px!important; padding: 0!important;" })*@
                                    @Html.ValidationMessageFor(model => model.Medicine.OINTTypeID, "", new { @class = "text-danger" })
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.OINTMore, htmlAttributes: new { @class = "control-label col-md-2" })*@
                                    @*<div class="col-md-10">
                                    *@
                                    @Html.EditorFor(model => model.Medicine.OINTMore, new { htmlAttributes = new { id = "Medicine_OINTMore1", Name = "Medicine_OINTMore", @style = "width:105px;", @class = "pre autocomplete", @type = "textbox", @value = "OINTOINT", @placeholder = "Medicine Name" } })
                                    @Html.ValidationMessageFor(model => model.Medicine.OINTMore, "", new { @class = "text-danger" })
                                    <input type="hidden" id="hfPatient" name="Pat_ID" />

                                    @Html.HiddenFor(model => model.PatientID, new { id = @ViewBag.PatientID })
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.Morning, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.DropDownList("MorningDozID", null, htmlAttributes: new { @id = "MorningDozID1", @class = "pre svar", @style = "width: 50px!important; padding: 0!important;" })
                                    @Html.ValidationMessageFor(model => model.Medicine.MorningDozID, "", new { @class = "text-danger" })


                                    @*@Html.EnumDropDownListFor(model => model.Medicine.Morning, htmlAttributes: new { @class = "pre svar", @style = "width: 40px!important; padding: 0!important;" })
                                        @Html.ValidationMessageFor(model => model.Medicine.Morning, "", new { @class = "text-danger" })*@
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.Noon, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.DropDownList("NoonDozID", null, htmlAttributes: new { @id = "NoonDozID1", @class = "pre bpor", @style = "width: 50px!important; padding: 0!important;" })
                                    @Html.ValidationMessageFor(model => model.Medicine.NoonDozID, "", new { @class = "text-danger" })
                                    @*@Html.EnumDropDownListFor(model => model.Medicine.Noon, htmlAttributes: new { @class = "pre bpor", @style = "width: 40px!important; padding: 0!important;" })
                                        @Html.ValidationMessageFor(model => model.Medicine.Noon, "", new { @class = "text-danger" })*@
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.Night, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.DropDownList("NightDozID", null, htmlAttributes: new { @id = "NightDozID1", @class = "pre sanj", @style = "width: 50px!important; padding: 0!important;" })
                                    @Html.ValidationMessageFor(model => model.Medicine.NightDozID, "", new { @class = "text-danger" })
                                    @*@Html.EnumDropDownListFor(model => model.Medicine.Night, htmlAttributes: new { @class = "pre sanj", @style = "width: 40px!important; padding: 0!important;" })
                                        @Html.ValidationMessageFor(model => model.Medicine.Night, "", new { @class = "text-danger" })*@
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.DozTiming, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.DropDownList("DosageID", null, htmlAttributes: new { @class = "pre", style = "width: 110px!important; padding: 0!important;" })
                                    @Html.ValidationMessageFor(model => model.Medicine.DosageID, "", new { @class = "text-danger" })
                                    @*@Html.EnumDropDownListFor(model => model.Medicine.Dosage, htmlAttributes: new { @class = "pre", style = "width: 90px!important; padding: 0!important;" })
                                        @Html.ValidationMessageFor(model => model.Medicine.Dosage, "", new { @class = "text-danger" })*@
                                    @*
                                            </div>
                                        </div>*@

                                    @*<div class="form-group">
                                        @Html.LabelFor(model => model.Medicine.Quantity, htmlAttributes: new { @class = "control-label col-md-2" })
                                        <div class="col-md-10">
                                    *@
                                    @Html.EditorFor(model => model.Medicine.Quantity, new { htmlAttributes = new { Name = "Medicine_Quantity", @id = "qut_1", @class = "pre qut", @placeholder = "Qty", @style = "width: 40px;color:#000; padding: 6px;" } })
                                    @Html.ValidationMessageFor(model => model.Medicine.Quantity, "", new { @class = "text-danger" })

                                    @Html.EditorFor(model => model.Medicine.Unit, new { htmlAttributes = new { Name = "Medicine_Unit", @id = "unt_1", @class = "pre qut", @placeholder = "Unit", @style = "width: 40px;color:#000; padding: 6px;", @readonly = "readonly" } })
                                    @Html.ValidationMessageFor(model => model.Medicine.Unit, "", new { @class = "text-danger" })

                                    <input type="text" Name="Medicine_Total" , id="mtotal_1" , class="pre qut" , placeholder="Total" , style="width: 40px;color:#000; padding: 6px;" , readonly="readonly" />

                                    <input value="+" class="add_field_button plusbutton" type="button" required>
                                    <a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a>

                                    <input type="hidden" id="days_flag1" value=true name="days_flag" />
                                    @*
                                            </div>
                                        </div>*@
                                </div>

                            </div>
                        </div>
                        <div style="display:block; clear:both;">
                            @*<div class="form-group">
                                @Html.LabelFor(model => model.DoctorID, "DoctorID", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                            *@
                            @Html.DropDownList("DoctorID", null, htmlAttributes: new { @class = "pre", @style = "width: 120px!important; padding: 0!important; color:#000; display:none;" })
                            @Html.ValidationMessageFor(model => model.DoctorID, "", new { @class = "text-danger" })
                            @*
                                    </div>
                                </div>*@

                            @*<div class="form-group">
                                @Html.LabelFor(model => model.PatientID, "PatientID", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                            *@
                            @*@Html.DropDownList("PatientID", null, htmlAttributes: new { @class = "pre", @style = "width: 90px!important; padding: 0!important; margin-left: 10px;color:#000;" })
                                @Html.ValidationMessageFor(model => model.PatientID, "", new { @class = "text-danger" })*@
                            @*
                                    </div>
                                </div>*@

                            @*<div class="form-group">*@
                            @*@Html.LabelFor(model => model.PatientTypeID, "PatientTypeID", htmlAttributes: new { @class = "control-label col-md-2" })*@
                            <div class="pat_type" style="clear:both; display:block; width:49%; float:left;">
                                @Html.DropDownList("PatientTypeID", null, htmlAttributes: new { @name = "patient_type", @class = "pre", @style = "width: 100%!important; padding: 0!important;color:#000;" })
                                @Html.ValidationMessageFor(model => model.PatientTypeID, "", new { @class = "text-danger" })
                            </div>

                            @*INVESTIGATION DROPDOWN CODE BELOW*@

                            <div id="Insturction" style="clear:both; display:block; width:49%; float:left;">
                                <label class="control-label col-md-2" , style="float:left; font-size: 90%; font-weight:700; padding:5px 5px 5px 0;">Investigations:</label>
                                @Html.ListBoxFor(model => model.SelectedInvestigationIDs, Model.Investigations, new { htmlAttributes = new { @size = 5, @class = "form-control", @Multiple = "multiple", @style = "height:140px !important; width:100% !important;" } })
                                @Html.ValidationMessageFor(model => model.Investigations, "", new { @class = "text-danger" })
                            </div>

                            @*</div>*@

                            @*@Html.HiddenFor(model => model.PatientID)
                                @Html.HiddenFor(model => model.PatientTypeID)*@

                            @*<div class="form-group">
                                @Html.LabelFor(model => model.InstructionID, "InstructionID", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                            *@

                            @*@Html.DropDownList("InstructionID", null, htmlAttributes: new { @name = "instructions", @class = "pre", @style = "width: 120px!important; padding: 0!important; margin-left: 10px;color:#000;" })
                                @Html.ValidationMessageFor(model => model.InstructionID, "", new { @class = "text-danger" })*@
                            <div id="Insturction" style="clear:both; display:block; width:49%; float:left;">
                                <label class="control-label col-md-2" , style="float:left; font-size: 90%; font-weight:700; padding:5px 5px 5px 0;">Instructions:</label>
                                @Html.ListBoxFor(model => model.SelectedInstructionsIDs, Model.Instructions, new { htmlAttributes = new { @size = 5, @class = "form-control", @Multiple = "multiple", @style = "height:140px !important; width:100% !important;" } })
                                @Html.ValidationMessageFor(model => model.Instructions, "", new { @class = "text-danger" })
                            </div>
                            <div id="select_image" style="float: right; width:49%;">
                                <label class="control-label col-md-2" , style="float:left; font-size: 90%; font-weight:700; padding:5px 5px 5px 0;">Images:</label>
                                @Html.ListBoxFor(model => model.SelectedPrescriptionImages, Model.PrescriptionImages, new { htmlAttributes = new { @size = 5, @class = "form-control", @Multiple = "multiple", @style = "height:50px !important; width:100% !important;" } })
                            </div>
                            @*
                                    </div>
                                </div>*@
                            
                            @*<div class="form-group">
                                    @Html.LabelFor(model => model.FollowDate, htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">
                                        @Html.EditorFor(model => model.FollowDate, new { htmlAttributes = new { @class = "form-control", name = "follow_datefollow_date", value = "", placeholder = "MM/DD/YYYY" } })
                                        @Html.ValidationMessageFor(model => model.FollowDate, "", new { @class = "text-danger" })
                                        @*
                                    </div>
                                </div>*@

                        </div>
                        <div style="display:block; width:auto; float:left; clear:both;">
                            @*@Html.LabelFor(model => model.FollowDate, htmlAttributes: new { @class = "control-label col-md-2", style="float:left; padding-left:0"})*@
                            <label class="control-label col-md-2" , style="float:left; font-size: 90%; font-weight:700; padding:5px 5px 0 0;">Follow Date</label>
                            @Html.EditorFor(model => model.FollowDate, new { htmlAttributes = new { @class = "form-control", name = "follow_datefollow_date", value = "", placeholder = "DD/MM/YYYY", style = "text-align:left;", type = "datetime-local" } })
                            @Html.ValidationMessageFor(model => model.FollowDate, "", new { @class = "text-danger" })
                        </div>

                        @*<div style="clear:both; display:block; width:100%; float:left;">*@
                            @*@Html.LabelFor(model => model.FollowDate, htmlAttributes: new { @class = "control-label col-md-2", style="float:left; padding-left:0"})*@
                            @*@Html.EditorFor(model => model.Investigation, new { htmlAttributes = new { @placeholder = "Investigation" } })
                                @Html.ValidationMessageFor(model => model.Investigation, "", new { @class = "text-danger" })*@
                            @*@Html.DropDownList("InvestigationID", null, htmlAttributes: new { @name = "InvestigationID", @class = "pre", @style = "width: 120px!important; padding: 0!important;color:#000;" })
        @Html.ValidationMessageFor(model => model.InvestigationID, "", new { @class = "text-danger" })
    </div>*@
                        



                        <div style=" width:100%; position:relative; clear:both; bottom:0;" class="pmtype_div">
                            <div id="payment_types">
                                @foreach (var item in Model.PaymentTypes)
                                {
                                    <input style="width:20px!important; padding: 0!important;" value="@item.ID" type="checkbox" name="pm_type" id="pmtype_@Html.DisplayFor(modelItem => item.ID)" class="pmtype" />
                                    <b style="width:10px!important; padding: 0!important;">@Html.DisplayFor(modelItem => item.PaymentTypeName)</b>
                                    <input type=hidden id="pmcharges_@Html.DisplayFor(modelItem => item.ID)" value="@Html.DisplayFor(modelItem => item.Rupees)" />
                                }
                            </div>
                            <div id="charges">
                                @Html.EditorFor(model => model.M, new { htmlAttributes = new { id = "pm_madicine", placeholder = " M", style = "width:60px!important; padding: 0!important; height:25px;", onkeyup = "cal_charges(event);" } })
                                @Html.ValidationMessageFor(model => model.M, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Other, new { htmlAttributes = new { id = "Other", placeholder = " Other", style = "width:60px!important; padding: 0!important; height:25px;", onkeyup = "cal_charges(event);" } })
                                @Html.ValidationMessageFor(model => model.Other, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Percent, new { htmlAttributes = new { id = "pm_less_perc", placeholder = " %", style = "width:60px!important; padding: 0!important; height:25px;", onkeyup = "cal_charges(event);" } })
                                @Html.ValidationMessageFor(model => model.Percent, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Less, new { htmlAttributes = new { id = "pm_less_net", placeholder = " Less net", style = "width:60px!important; padding: 0!important; height:25px;", onkeyup = "less_net_changed(event);" } })
                                @Html.ValidationMessageFor(model => model.Less, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Rs, new { htmlAttributes = new { name = "pm_rupees", placeholder = " Rs.0", style = "width:60px!important; padding: 0!important; height:25px;", id = "pm_rupees" } })
                                @Html.ValidationMessageFor(model => model.Rs, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Received, new { htmlAttributes = new { name = "pm_rupees", placeholder = "Recieved", style = "width:60px!important; padding: 0!important; height:25px;", id = "pm_received", onkeyup = "cal_pending(event);" } })
                                @Html.ValidationMessageFor(model => model.Received, "", new { @class = "text-danger" })

                                @Html.EditorFor(model => model.Pending, new { htmlAttributes = new { name = "pm_rupees", placeholder = "Pending", style = "width:60px!important; padding: 0!important; height:25px; pointer-events: none;", id = "pm_pending", @readonly="readonly" } })
                                @Html.ValidationMessageFor(model => model.Pending, "", new { @class = "text-danger" })

                                @*@Html.EditorFor(model => model.Other, new { htmlAttributes = new { id = "Other", placeholder = " Other", style = "width:100px!important; padding: 0!important; height:25px;" } })
                                @Html.ValidationMessageFor(model => model.Other, "", new { @class = "text-danger" })*@

                                @Html.HiddenFor(model => model.PatientImage1)
                            </div>
                        </div>
                        @*<div id="patient_image">
                                <div id="draw_image" style="float: left; width:35%;">
                                    <img id="canvac_background" width="235" height="235" src="~/Content/Images/patient_drawing_image_bg.jpg" alt="Canvas background" style="display:none;">
                                    <div style="background:url('/Content/Images/patient_drawing_image_bg.jpg') no-repeat;">
                                        <canvas id="canvasss" width="235" height="235" style=" position:relative;border:2px solid;"></canvas>
                                    </div>
                                    <div id="imagecolor">
                                        <div style="position:relative;top:12%;text-align:left;margin-bottom:5px;">Choose Drawing Color</div>
                                        <div class="margin-right" style="position:relative;background:green;" id="green" onclick="color(this)"></div>
                                        <div class="margin-right" style="position:relative;background:blue;" id="blue" onclick="color(this)"></div>
                                        <div class="margin-right" style="position:relative;float:left;background:red;" id="red" onclick="color(this)"></div>
                                        <div class="margin-right" style="position:relative;float:left;background:yellow;" id="yellow" onclick="color(this)"></div>
                                        <div class="margin-right" style="position:relative;float:left;background:orange;" id="orange" onclick="color(this)"></div>
                                        <div class="margin-right" style="position:relative;float:left;background:black;" id="black" onclick="color(this)"></div>
                                    </div>
                                    <div id="eraser">
                                        <input type="button" value="Clear" id="clr" size="23" onclick="erase()" style="position:relative;top:20%;left:0%;">
                                    </div>
                                </div>
                                <div id="select_image" style="float: right; width:60%;">
                                    @Html.ListBoxFor(model => model.SelectedPrescriptionImages, Model.PrescriptionImages, new { htmlAttributes = new { @size = 5, @class = "form-control", @Multiple = "multiple", @style = "height:50px !important; width:100% !important;" } })
                                </div>
                            </div>*@
                        <div id="prescription_submit" style="width:100%; clear:both;">
                            <input type="submit" value="Create" class="next action-button" onclick="saveimage()" />
                        </div>

                    </fieldset>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        //jQuery.noConflict();
        document.addEventListener('DOMContentLoaded', function () {
            var i = 2;
            $(".btn_p").click(function (event) {
                $.ajax({
                    url: '@Url.Action("MedicineList", "Home")',
                    data: { id: $(this).val() /* add other additional parameters */ },
                    cache: false,
                    type: "POST",
                    dataType: "html",
                    success: function (data, textStatus, XMLHttpRequest) {
                        $("#input_fields_wrap_js").html(data);
                        //alert($("#input_fields_wrap_js div").length);
                        //i = parseInt($("#input_fields_wrap_js div").length);
                    }
                });
            });

            function dynamichtmlstring(newhtmlstring, id) {
                var a = parseInt(id - 1);
                //    newhtmlstring = newhtmlstring.replace("tabname_1", "tabname_1" + id);
                //    newhtmlstring = newhtmlstring.replace("Medicine_OINTMore", "Medicine_OINTMore" + id);
                newhtmlstring = newhtmlstring.replace("Medicine_OINTMore" + a, "Medicine_OINTMore" + id);
                newhtmlstring = newhtmlstring.replace("MorningDozID" + a, "MorningDozID" + id);
                newhtmlstring = newhtmlstring.replace("NoonDozID" + a, "NoonDozID" + id);
                newhtmlstring = newhtmlstring.replace("NightDozID" + a, "NightDozID" + id);
                newhtmlstring = newhtmlstring.replace("days_flag" + a, "days_flag" + id);

                //    newhtmlstring = newhtmlstring.replace("DosageID", "DosageID" + id);

                newhtmlstring = newhtmlstring.replace("qut_" + a, "qut_" + id);
                newhtmlstring = newhtmlstring.replace("unt_" + a, "unt_" + id);
                newhtmlstring = newhtmlstring.replace("mtotal_" + a, "mtotal_" + id);
                
                return newhtmlstring;
            }

            var wrapper = jQuery(".input_fields_wrap");
            //jQuery(".add_field_button").click(function () {
            var max_fields = 30; //maximum input boxes allowed
            //Fields wrapper
            //var add_button = jQuery(".add_field_button"); //Add button ID
            var x = jQuery(".toatalrowcou").val(); //initlal text box count
            var htmlString = $("#divname_1").html();




            //jQuery(add_button).click(function (e) { //on add input button click
            //    e.preventDefault();
            //    var x = jQuery(".divnamepresc").length;
            //    if (x < max_fields) { //max input box allowed
            //        x++; //text box increment
            //        var inc = x;
            //        inc--;
            //        var IDName = x;
            //        //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINT" data-valmsg-replace="true"></span><input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="OINT" style="width:120px;" type="textbox" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 90px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select>                                    <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.DozTiming" data-valmsg-replace="true"></span><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>'); //add input box
            //        jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="Medicine Name" style="width:110px;" type="textbox" value="" /> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 120px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.Quantity" data-valmsg-replace="true"></span><input value="+" class="add_field_button plusbutton" type="button" required><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>');
            //    }
            //});
            var flag;
            var mainwrapper = jQuery(".btn_box");
            jQuery(mainwrapper).on("click", ".plusbutton", function (e) { //user click on remove text
                //var htmlString = $("#divname_1").html();
                e.preventDefault();
                var x = jQuery(".divnamepresc").length;
                if (x < max_fields) { //max input box allowed
                    x++; //text box increment
                    var inc = x;
                    inc--;
                    //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINT" data-valmsg-replace="true"></span><input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="OINT" style="width:120px;" type="textbox" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 90px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select>                                    <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.DozTiming" data-valmsg-replace="true"></span><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>'); //add input box
                    //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="Medicine Name" style="width:110px;" type="textbox" value="" /> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 120px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.Quantity" data-valmsg-replace="true"></span><input value="+" class="add_field_button plusbutton" type="button" required><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>');
                    //var htmlString = $("#divname_1").html();

                    htmlString = dynamichtmlstring(htmlString, i);
                    i++;

                    //alert(htmlString);
                    jQuery(wrapper).append('<div style="clear:both;">' + htmlString + '</div>');

                    jQuery("#qut_" + parseInt(i - 1)).blur(function () {
                        var current_rec = $(this).attr('id').substring(4);
                        calc_qty_change(current_rec);
                    });


                    $("#MorningDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(12);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });

                    $("#NoonDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(9);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });

                    $("#NightDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(10);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });
                }
            });

            jQuery(wrapper).on("click", ".plusbutton", function (e) { //user click on remove text
                //var htmlString = $("#divname_1").html();
                e.preventDefault();
                var x = jQuery(".divnamepresc").length;
                if (x < max_fields) { //max input box allowed
                    x++; //text box increment
                    var inc = x;
                    inc--;
                    //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINT" data-valmsg-replace="true"></span><input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="OINT" style="width:120px;" type="textbox" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 90px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select>                                    <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.DozTiming" data-valmsg-replace="true"></span><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>'); //add input box
                    //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="Medicine Name" style="width:110px;" type="textbox" value="" /> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 60px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 120px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.Quantity" data-valmsg-replace="true"></span><input value="+" class="add_field_button plusbutton" type="button" required><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>');
                    //var htmlString = $("#divname_1").html();

                    htmlString = dynamichtmlstring(htmlString, i);
                    i++;

                    //alert(htmlString);

                    jQuery(wrapper).append('<div style="clear:both;">' + htmlString + '</div>');


                    jQuery("#qut_" + parseInt(i - 1)).blur(function () {
                        var current_rec = $(this).attr('id').substring(4);
                        calc_qty_change(current_rec);
                    });

                    $("#MorningDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(12);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });

                    $("#NoonDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(9);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });

                    $("#NightDozID" + parseInt(i - 1)).change(function () {
                        var current_rec = $(this).attr('id').substring(10);
                        calc_qty(current_rec);
                        //calc_qty(flag);
                    });

                }
            });

            jQuery(wrapper).on("click", ".remove_field", function (e) { //user click on remove text
                e.preventDefault(); jQuery(this).parent('div').remove();
                //i--;
            });


            //jQuery.noConflict();
            //document.addEventListener('DOMContentLoaded', function () {
            //    jQuery(wrapper).on("click", ".add_field_button", function (e) { //user click on remove text
            //        var wrapper = jQuery(".input_fields_wrap");
            //        //jQuery(".add_field_button").click(function () {
            //        var max_fields = 30; //maximum input boxes allowed
            //        e.preventDefault();
            //        var x = jQuery(".divnamepresc").length;
            //        if (x < max_fields) { //max input box allowed
            //            x++; //text box increment
            //            var inc = x;
            //            inc--;
            //            var IDName = x;
            //            //jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINT" data-valmsg-replace="true"></span><input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="OINT" style="width:120px;" type="textbox" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">Zero</option><option value="1">Half</option><option value="2">One</option><option value="3">Two</option><option value="4">Three</option><option value="5">Four</option><option value="6">FiveMl</option><option value="7">TenMl</option><option value="8">FifteenMl</option><option value="9">TwentyMl</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 90px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select>                                    <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.DozTiming" data-valmsg-replace="true"></span><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>'); //add input box
            //            jQuery(wrapper).append('<div id="divname"' + IDName + '" class="divnamepresc"> <select class="pre tabname" data-val="true" data-val-required="The OINT field is required." id="tabname_1" name="Medicine.OINT" style="width: 85px!important; padding: 0!important;"><option selected="selected" value="0">Tab</option> <option value="1">Syp</option> <option value="2">Cap</option> </select> <input class="pre text-box single-line" id="Medicine_OINTMore" name="Medicine.OINTMore" placeholder="OINT" style="width:120px;" type="textbox" value="" /> <span class="field-validation-valid text-danger" data-valmsg-for="Medicine.OINTMore" data-valmsg-replace="true"></span><select class="pre svar" data-val="true" data-val-required="The Morning field is required." id="Medicine_Morning" name="Medicine.Morning" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre bpor" data-val="true" data-val-required="The Noon field is required." id="Medicine_Noon" name="Medicine.Noon" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre sanj" data-val="true" data-val-required="The Night field is required." id="Medicine_Night" name="Medicine.Night" style="width: 40px!important; padding: 0!important;"><option selected="selected" value="0">0</option><option value="1">1/2</option><option value="2">1</option><option value="3">2</option><option value="4">3</option><option value="5">4</option><option value="6">5ml</option><option value="7">10ml</option><option value="8">15ml</option><option value="9">20ml</option></select><select class="pre" data-val="true" data-val-required="The DozTiming field is required." id="Medicine_DozTiming" name="Medicine.DozTiming" style="width: 90px!important; padding: 0!important;"><option selected="selected" value="0">AfterFood</option><option value="1">BeforeFood</option></select><input class="pre qut text-box single-line" data-val="true" data-val-number="The field Quantity must be a number." data-val-required="The Quantity field is required." id="qut_1" name="Medicine.Quantity" placeholder="Qty" style="width: 50px;color:#000; padding: 6px;" type="text" value="" /><span class="field-validation-valid text-danger" data-valmsg-for="Medicine.Quantity" data-valmsg-replace="true"></span><input style="border: 1px solid yellow;color:red;" value="+" class="add_field_button btn_p" type="button" required><a href="#" class="remove_field" style="text-decoration:none;font-weight:bold; float:left;">--</a></div>');
            //        }
            //    });
            //});

            /* CODE FOR CHANGING QUANTITY ACCORDING TO DAYS HERE  */
            jQuery("#patient_days_presc").blur(function () {
                for (count = 1; count <= jQuery("#input_fields_wrap_js > div").length; count++) {
                    calc_qty(count);
                    //alert(count);
                }
            });
            
            

            function medicine_total()
            {
                alert("Hi");
                var medicine_total = 0;
                for (count = 1; count <= i; count++) {
                    medicine_total = medicine_total + jQuery("#mtotal_" + parseInt(count)).val();
                }
                jQuery("#pm_madicine").val(medicine_total);
            }

            function calc_qty_change(current_rec) {
                qty = jQuery("#qut_" + parseInt(current_rec)).val();
                var mtot = jQuery("#unt_" + parseInt(current_rec)).val() * qty;
                jQuery("#mtotal_" + parseInt(current_rec)).val(mtot);
                medicine_total();
            }


            function calc_qty(current_rec) {
                var mor, noon, night;
                    //alert("days_flag" + current_rec + "Value = " + jQuery("#days_flag" + parseInt(current_rec)).val());
                    var qtyflag = (jQuery("#days_flag" + parseInt(current_rec)).val());
                    var qty = 0;
                    if (qtyflag == "true") {
                        var days = document.getElementById("patient_days_presc").value;
                        if ($('option:selected', $("#MorningDozID" + parseInt(current_rec))).text() == "1/2") {
                            mor = parseFloat(0.5);
                        }
                        else {
                            mor = $('option:selected', $("#MorningDozID" + parseInt(current_rec))).text();
                        }
                        if ($('option:selected', $("#NoonDozID" + parseInt(current_rec))).text() == "1/2") {
                            noon = parseFloat(0.5);
                        }
                        else {
                            noon = $('option:selected', $("#NoonDozID" + parseInt(current_rec))).text();
                        }
                        if ($('option:selected', $("#NightDozID" + parseInt(current_rec))).text() == "1/2") {
                            night = parseFloat(0.5);
                        }
                        else {
                            night = $('option:selected', $("#NightDozID" + parseInt(current_rec))).text();
                        }
                        //alert("Days : " + days + ", Morning : " + mor + ", Noon : " + noon + ", Night : " + night);
                        qty = (parseFloat(mor) + parseFloat(noon) + parseFloat(night)) * parseFloat(days);
                        jQuery("#qut_" + parseInt(current_rec)).val(qty);

                    }
                    else {
                        qty = 0;
                        jQuery("#qut_" + parseInt(current_rec)).val(0);
                    }
                    var mtot = jQuery("#unt_" + parseInt(current_rec)).val() * qty;
                    jQuery("#mtotal_" + parseInt(current_rec)).val(mtot);
                    medicine_total();
            }

            //function calc_qty(current_rec) {
            //    var mor, noon, night;
            //    //for (count = 1; count <= jQuery("#input_fields_wrap_js > div").length; count++)
            //    for (count = 1; count <= i; count++) {
            //        //alert("days_flag" + count + "Value = " + jQuery("#days_flag" + parseInt(count)).val());
            //        var qtyflag = (jQuery("#days_flag" + parseInt(count)).val());
            //        var qty = 0;
            //        if (qtyflag == "true") {
            //            var days = document.getElementById("patient_days_presc").value;
            //            if ($('option:selected', $("#MorningDozID" + parseInt(count))).text() == "1/2") {
            //                mor = parseFloat(0.5);
            //            }
            //            else {
            //                mor = $('option:selected', $("#MorningDozID" + parseInt(count))).text();
            //            }
            //            if ($('option:selected', $("#NoonDozID" + parseInt(count))).text() == "1/2") {
            //                noon = parseFloat(0.5);
            //            }
            //            else {
            //                noon = $('option:selected', $("#NoonDozID" + parseInt(count))).text();
            //            }
            //            if ($('option:selected', $("#NightDozID" + parseInt(count))).text() == "1/2") {
            //                night = parseFloat(0.5);
            //            }
            //            else {
            //                night = $('option:selected', $("#NightDozID" + parseInt(count))).text();
            //            }
            //            //alert("Days : " + days + ", Morning : " + mor + ", Noon : " + noon + ", Night : " + night);
            //            qty = (parseFloat(mor) + parseFloat(noon) + parseFloat(night)) * parseFloat(days);
            //            jQuery("#qut_" + parseInt(count)).val(qty);
                       
            //        }
            //        else {
            //            qty = 0;
            //            jQuery("#qut_" + parseInt(count)).val(0);
            //        }
            //        var mtot = jQuery("#unt_" + parseInt(count)).val() * qty;
            //        jQuery("#mtotal_" + parseInt(count)).val(mtot);
            //    }
            //}

            //var isdayaffected = true;
            //function calc_qty(flag) {
            //    if (isdayaffected == true && flag == true) {
            //        var mor, noon, night;
            //        var days = document.getElementById("patient_days_presc").value;
            //        if ($('option:selected', $("#MorningDozID" + parseInt(i - 1))).text() == "1/2") {
            //            mor = parseFloat(0.5);
            //        }
            //        else {
            //            mor = $('option:selected', $("#MorningDozID" + parseInt(i - 1))).text();
            //        }
            //        if ($('option:selected', $("#NoonDozID" + parseInt(i - 1))).text() == "1/2") {
            //            noon = parseFloat(0.5);
            //        }
            //        else {
            //            noon = $('option:selected', $("#NoonDozID" + parseInt(i - 1))).text();
            //        }
            //        if ($('option:selected', $("#NightDozID" + parseInt(i - 1))).text() == "1/2") {
            //            night = parseFloat(0.5);
            //        }
            //        else {
            //            night = $('option:selected', $("#NightDozID" + parseInt(i - 1))).text();
            //        }
            //        //alert("Days : " + days + ", Morning : " + mor + ", Noon : " + noon + ", Night : " + night);
            //        var qty = (parseFloat(mor) + parseFloat(noon) + parseFloat(night)) * parseFloat(days);
            //        jQuery("#qut_" + parseInt(i - 1)).val(qty);
            //    }
            //    else {
            //        jQuery("#qut_" + parseInt(i - 1)).val(0);
            //    }
            //}

            jQuery("#qut_" + parseInt(i - 1)).blur(function () {
                var current_rec = $(this).attr('id').substring(4);
                calc_qty_change(current_rec);
            });

            var medicine_total = 0;
            $("#MorningDozID" + parseInt(i - 1)).change(function () {
                var current_rec = $(this).attr('id').substring(12);
                calc_qty(current_rec);
            });

            $("#NoonDozID" + parseInt(i - 1)).change(function () {
                var current_rec = $(this).attr('id').substring(9);
                calc_qty(current_rec);
            });

            $("#NightDozID" + parseInt(i - 1)).change(function () {
                var current_rec = $(this).attr('id').substring(10);
                calc_qty(current_rec);
            });

            jQuery(function () {
                jQuery(".autocomplete").autocomplete({
                    source: function (request, response) {
                        jQuery.ajax({
                            url: '/Home/AutoComplete/',
                            data: "{ 'MedicineName': '" + request.term + "'}",
                            dataType: "json",
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            success: function (data) {
                                response(jQuery.map(data, function (item) {
                                    return {
                                        label: item.OINTMore,
                                        value: item.OINTMore,
                                        term: item.IsDayAffected,
                                        quantity:item.Quantity,
                                        unit: item.Unit
                                    }
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, j) {
                        //var qty;
                        //if (j.item.term == true) {
                        //    qty = parseFloat(jQuery("#qut_" + parseInt(i - 1)).val());
                        //}
                        //else {
                        //    jQuery("#qty_" + parseInt(i - 1)).val(j.item.quantity);
                        //    qty = parseFloat(j.item.quantity);
                        //}
                        
                        ////var qty = parseFloat(jQuery("#qut_" + parseInt(i - 1)).val());
                        //var mtot = (parseFloat(j.item.unit) * qty);
                        //jQuery("#mtotal_" + parseInt(i - 1)).val(mtot);


                        var current_rec = $(this).attr('id').substring(17);
                        jQuery("#days_flag" + parseInt(i - 1)).val(j.item.term);
                        jQuery("#unt_" + parseInt(i - 1)).val(j.item.unit);

                        //if (j.item.term == true) {
                        
                        //flag = true;
                        calc_qty(current_rec);
                        //var isdayaffected = false;
                        //}
                        //else {
                        //    //flag = false;
                        //    //calc_qty(flag);
                        //}
                    },
                    minLength: 1
                });
            });

            $(document).on('click', '.plusbutton', function (event) {
                jQuery(".autocomplete").autocomplete({
                    source: function (request, response) {
                        jQuery.ajax({
                            url: '/Home/AutoComplete/',
                            data: "{ 'MedicineName': '" + request.term + "'}",
                            dataType: "json",
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            success: function (data) {
                                response(jQuery.map(data, function (item) {
                                    return {
                                        label: item.OINTMore,
                                        value: item.OINTMore,
                                        term: item.IsDayAffected,
                                        quantity: item.Quantity,
                                        unit: item.Unit
                                    }
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, j) {

                        //var qty;
                        //if (j.item.term == true) {
                        //    qty = parseFloat(jQuery("#qut_" + parseInt(i - 1)).val());
                        //}
                        //else {
                        //    jQuery("#qty_" + parseInt(i - 1)).val(j.item.quantity);
                        //    qty = parseFloat(j.item.quantity);
                        //}
                        //jQuery("#unt_" + parseInt(i - 1)).val(j.item.unit);
                        ////var qty = parseFloat(jQuery("#qut_" + parseInt(i - 1)).val());
                        //var mtot = (parseFloat(j.item.unit) * qty);
                        //jQuery("#mtotal_" + parseInt(i - 1)).val(mtot);


                        var current_rec = $(this).attr('id').substring(17);
                        jQuery("#days_flag" + parseInt(i - 1)).val(j.item.term);
                        jQuery("#unt_" + parseInt(i - 1)).val(j.item.unit);
                        //if (j.item.term == true) {

                        //flag = true;
                        calc_qty(current_rec);
                        //var isdayaffected = false;
                        //}
                        //else {
                        //    //flag = false;
                        //    //calc_qty(flag);
                        //}
                    },
                    minLength: 1
                });
            });

        });



        //jQuery.noConflict();
        document.addEventListener('DOMContentLoaded', function () {
            jQuery(".pmtype_div .pmtype").click(function () {
                var total_charges = 0;
                jQuery(".pmtype").each(function (index, element) {
                    var a = this.id;
                    if (jQuery("#" + a).is(':checked')) {
                        a = a.split("_");
                        total_charges = total_charges + parseInt(jQuery("#pmcharges_" + a[1]).val());
                    }
                });//each pmtype

                //add madicine charges to totalcharges

                if (jQuery.isNumeric(jQuery("input[id=pm_madicine]").val()))
                    total_charges = total_charges + parseInt(jQuery("input[id=pm_madicine]").val());

                var less_perc = 0;
                if (jQuery.isNumeric(jQuery("input[name=pm_less_perc]").val()))
                    less_perc = parseInt(jQuery("input[name=pm_less_perc]").val());

                var less_net = total_charges * less_perc / 100;

                jQuery("input[name=pm_less_net]").val(less_net);
                total_charges = total_charges - less_net;
                jQuery("#pm_rupees").val(total_charges);

            });//on click pmtype class
        });

        function cal_charges(event) {
            if (event.keyCode == 9 || event.keyCode == 16)
                return false;

            if (jQuery.isNumeric(jQuery("input[id=pm_less_perc]").val()) || jQuery.isNumeric(jQuery("input[id=pm_madicine]").val())) {
            }
            else {
                return false;
            }
            var total_charges = 0;
            jQuery(".pmtype").each(function (index, element) {
                var a = this.id;
                if (jQuery("#" + a).is(':checked')) {
                    a = a.split("_");
                    total_charges = total_charges + parseInt(jQuery("#pmcharges_" + a[1]).val());
                }
            });//each pmtype

            // Calculate Pending Amount

            //jQuery("#Received").on('change keyup paste', function () {
            //    alert("Change detected!");
            //});

            //add madicine charges to totalcharges

            if (jQuery.isNumeric(jQuery("input[id=pm_madicine]").val()))
                total_charges = total_charges + parseInt(jQuery("input[id=pm_madicine]").val());

            // ADD OTHER CHARGES TO TOTAL CHARGES
            if (jQuery.isNumeric(jQuery("input[id=Other]").val()))
                total_charges = total_charges + parseInt(jQuery("input[id=Other]").val());

            var less_perc = 0;
            if (jQuery.isNumeric(jQuery("input[id=pm_less_perc]").val()))
                less_perc = parseInt(jQuery("input[id=pm_less_perc]").val());

            var less_net =  parseInt(jQuery("input[id=pm_madicine]").val()) * less_perc / 100;

            jQuery("input[id=pm_less_net]").val(less_net);
            total_charges = total_charges - less_net;
            jQuery("#pm_rupees").val(total_charges);
        }

        function cal_pending(event) {
            if (event.keyCode == 9 || event.keyCode == 16)
                return false;
            var pendng_amt = 0;
            if (jQuery.isNumeric(jQuery("#pm_received").val())) {
                pending_amt = jQuery("input[id=pm_rupees]").val() - jQuery("input[id=pm_received]").val();
                jQuery("input[id=pm_pending]").val(pending_amt);
            }

        }

        function less_net_changed(event) {
            if (event.keyCode == 9 || event.keyCode == 16)
                return false;

            if (jQuery.isNumeric(jQuery("input[id=pm_less_net]").val())) {
            }
            else {
                return false;
            }

            var total_charges = 0;
            jQuery(".pmtype").each(function (index, element) {
                var a = this.id;
                if (jQuery("#" + a).is(':checked')) {
                    a = a.split("_");
                    total_charges = total_charges + parseInt(jQuery("#pmcharges_" + a[1]).val());
                }
            });//each pmtype

            //add madicine charges to totalcharges

            if (jQuery.isNumeric(jQuery("input[id=pm_madicine]").val()))
                total_charges = total_charges + parseInt(jQuery("input[id=pm_madicine]").val());

            if (jQuery.isNumeric(jQuery("input[id=pm_less_net]").val()))
                less_net = parseInt(jQuery("input[id=pm_less_net]").val());
            total_charges = total_charges - less_net;
            jQuery("#pm_rupees").val(total_charges);
        }

    </script>


    <script type="text/javascript">

        function patientimage() {
            jQuery("#DrawImage").dialog({
                autoOpen: true,
                position: { my: "top", at: "top", of: window },
                //width: 1200,
                //resizable: false,
                title: 'Patient Image',
                modal: true,
                dialogClass: 'searchdialog',
                open: function () {
                    jQuery(this).load('@Url.Action("Webcam", "Home", new { id = @ViewBag.PatientID })');
                    jQuery('#DrawImage').focus();
                },
                close: function () {
                    jQuery.getScript('../Content/js/jquery-ui.min.js');
                    jQuery.getScript('../Content/js/jquery-1.12.0.min.js');
                    jQuery.getScript('../Content/autocomplete/jquery-ui.js');
                    jQuery("#my-iframe").append("<link rel='stylesheet' type='text/css' href='../Content/css/style.css' />");
                },
            });
            return false;
        }
        function imagelightbox() {
            jQuery("#ImageLightbox").dialog({
                autoOpen: true,
                position: { my: "top", at: "top", of: window },
                //                width: 1200,
                //resizable: false,
                title: 'Image Lightbox',
                modal: true,
                dialogClass: 'searchdialog',
                open: function () {
                    jQuery(this).load('@Url.Action("ImageLightbox", "Home", new { id = @ViewBag.PatientID, imageID = 1})');
                    jQuery('#ImageLightbox').focus();
                },
                close: function () {
                    jQuery.getScript('../Content/js/jquery-ui.min.js');
                    jQuery.getScript('../Content/js/jquery-1.12.0.min.js');
                    jQuery.getScript('../Content/autocomplete/jquery-ui.js');
                    jQuery("#my-iframe").append("<link rel='stylesheet' type='text/css' href='../Content/css/style.css' />");
                },
            });
            return false;
        }
    </script>
    @*function printform() {
            jQuery("#PrintForm").dialog({
                autoOpen: true,
                position: { my: "top", at: "top", of: window },
                //width: 1200,
                //resizable: false,
                title: 'Print',
                modal: true,
                classname: 'searchdialog',
                open: function () {
                    jQuery(this).load('@Url.Action("Print", "Home", new { id = @ViewBag.PatientID })');
                    jQuery('#PrintForm').focus();
                },
                close: function () {
                    //javascript: location.reload(true);
                    //searchpatient(this).load('@Url.Action("Index", "Home")');
                    },
            });
            return false;
        }*@





    @*<script type="text/javascript">

            document.addEventListener('DOMContentLoaded', function () {
                init();
            });
            var canvas, ctx, flag = false,
            prevX = 0,
            currX = 0,
            prevY = 0,
            currY = 0,
            dot_flag = false;

            var x = "red",
                y = 5;

            function init() {
                canvas = document.getElementById('canvasss');
                ctx = canvas.getContext("2d");
                w = canvas.width;
                h = canvas.height;

                var img = document.getElementById("canvac_background");
                //ctx.drawImage(img, 0, 0);

                canvas.addEventListener("mousemove", function (e) {
                    findxy('move', e)
                }, false);
                canvas.addEventListener("mousedown", function (e) {
                    findxy('down', e)
                }, false);
                canvas.addEventListener("mouseup", function (e) {
                    findxy('up', e)
                }, false);
                canvas.addEventListener("mouseout", function (e) {
                    findxy('out', e)
                }, false);
            }

            function color(obj) {
                switch (obj.id) {
                    case "green":
                        x = "green";
                        break;
                    case "blue":
                        x = "blue";
                        break;
                    case "red":
                        x = "red";
                        break;
                    case "yellow":
                        x = "yellow";
                        break;
                    case "orange":
                        x = "orange";
                        break;
                    case "black":
                        x = "black";
                        break;
                    case "white":
                        x = "white";
                        break;
                }
                if (x == "white") y = 14;
                else y = 5;

            }

            function draw() {
                ctx.beginPath();
                ctx.moveTo(prevX, prevY);
                ctx.lineTo(currX, currY);
                ctx.strokeStyle = x;
                ctx.lineWidth = y;
                ctx.stroke();
                ctx.closePath();
            }

            function erase() {
                var m = confirm("Want to clear");
                if (m) {
                    ctx.clearRect(0, 0, w, h);
                    document.getElementById("canvasimg").style.display = "none";
                }
            }

            function save() {
                document.getElementById("canvasimg").style.border = "2px solid";
                var dataURL = canvas.toDataURL();
                document.getElementById("canvasimg").src = dataURL;
                //document.getElementById("canvasimg").style.display = "inline";
            }

            function findxy(res, e) {
                if (res == 'down') {
                    prevX = currX;
                    prevY = currY;
                    currX = e.clientX - canvas.offsetLeft;
                    currY = e.clientY - canvas.offsetTop;

                    flag = true;
                    dot_flag = true;
                    if (dot_flag) {
                        ctx.beginPath();
                        ctx.fillStyle = x;
                        ctx.fillRect(currX, currY, 2, 2);
                        ctx.closePath();
                        dot_flag = false;
                    }
                }
                if (res == 'up' || res == "out") {
                    flag = false;
                }
                if (res == 'move') {
                    if (flag) {
                        prevX = currX;
                        prevY = currY;
                        currX = e.clientX - canvas.offsetLeft;
                        currY = e.clientY - canvas.offsetTop;
                        draw();
                    }
                }
            }
            //var dataURL = canvas.toDataURL();
            function saveimage() {
                //document.getElementById("PatientImage").style.border = "2px solid";
                var dataURL = canvas.toDataURL();
                //document.getElementById("PatientImage").src = dataURL;
                document.getElementById("PatientImage").value = dataURL;
                document.getElementById("PatientImage").value = dataURL;

                //$.ajax({
                //    type: "POST",
                //    url: "/Home/DrawImage/?data="+dataURL.toString(),
                //    data: {
                //        imgBase64: dataURL
                //    }
                //}).done(function (o) {
                //    alert("Saved");
                //    // If you want the file to be visible in the browser
                //    // - please modify the callback in javascript. All you
                //    // need is to return the url to the file, you just saved
                //    // and than put the image in your browser.
                //});
            }
        </script>*@


    @section Scripts {
        @Scripts.Render("~/bundles/jqueryval")
    }
}